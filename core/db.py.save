#!/usr/bin/python
import sys
import os
import redis

sys.path.append(os.path.abspath(os.path.dirname(__file__))+"/../")
import core
logger = core.get_logger(__name__)
config = core.get_config()

db = None

def get_schema(key):
	return config["db_schema"]+":"+key

def connect():
	global db
	if db is None: 
		db = redis.StrictRedis(host=config["db_hostname"], port=config["db_port"], db=config["db_number"])
		logger.debug("connected to DB: "+str(db))
	return db


def keys(key):
	db = connect()
	key = get_schema(key)
	logger.debug("keys "+key)
	return db.keys(key)


def set(key,value,timestamp):
	db = connect()
	key = get_schema(key)
	if timestamp is None: 
		logger.debug("set "+key+" "+str(value))
		return db.set(key,value)
	else: 
		value = value+":"+timestamp
		logger.debug("zadd "+key+" "+str(timestamp)+" "+str(value))
		return db.zadd(key,timestamp,value)

def get(key):
        db = connect()
        key = get_schema(key)
	logger.debug("get "+key)
	return db.get(key)

def rangebyscore(key,start,end):
	db = connect()
	key = get_schema(key)
	logger.debug("zrangebyscore "+key+" "+str(start)+" "+str(end))
	data = db.zrangebyscore(key,start,end)

def range(key,start-1,end):
        db = connect()
        key = get_schema(key)
        logger.debug("zrange "+key+" "+str(start)+" "+str(end))
        data = db.zrange(key,start,end)




print select_single("weather:forecast")
